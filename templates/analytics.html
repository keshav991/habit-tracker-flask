{% extends 'base.html' %}

{% block content %}
<h1 class="text-2xl font-semibold mb-4">Analytics</h1>

<p class="opacity-80 mb-4 text-sm">
  Past 7 days of total check-ins across all habits.
</p>

<div class="card rounded-2xl p-4">
  <canvas id="chart" height="140"></canvas>
  <div id="summary" class="text-sm opacity-80 mt-3"></div>
</div>

<h2 class="text-xl font-semibold mt-8 mb-3">Your Habits</h2>

<div class="grid gap-3">
  {% if habits %}
    {% for habit in habits %}
    <div class="card rounded-2xl p-4 flex items-center gap-3">
      <div class="w-3 h-3 rounded-full" style="background: {{ habit.color }}"></div>
      <div class="font-medium">{{ habit.name }}</div>
    </div>
    {% endfor %}
  {% else %}
    <div class="opacity-60 text-sm">No habits yet.</div>
  {% endif %}
</div>

<script>
fetch("/analytics.json")
  .then(r => r.json())
  .then(({ labels, data }) => {
    const total = data.reduce((a, b) => a + b, 0);
    document.getElementById('summary').textContent =
      'Total check-ins this week: ' + total;

    new Chart(document.getElementById("chart"), {
      type: "bar",
      data: {
        labels,
        datasets: [{ label: "Check-ins", data }]
      },
      options: {
        scales: { y: { beginAtZero: true, precision: 0 } }
      }
    });
  });
</script>

{% endblock %}


